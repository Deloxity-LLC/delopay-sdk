{
  "openapi": "3.0.1",
  "info": {
    "title": "DeloPay API",
    "description": "Unified Payment Gateway API",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "{baseUrl}",
      "variables": {
        "baseUrl": {
          "default": "https://sandbox-delopay.deloxity.com"
        }
      }
    }
  ],
  "paths": {
    "/api/payments/create": {
      "post": {
        "tags": [
          "Payments"
        ],
        "summary": "Create a new payment",
        "operationId": "createPayment",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreatePaymentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaymentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/payments/{paymentId}": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "Get payment by ID",
        "operationId": "getPayment",
        "parameters": [
          {
            "name": "paymentId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Payment found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaymentResponse"
                }
              }
            }
          },
          "404": {
            "description": "Payment not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "Payments"
        ],
        "summary": "Update payment details",
        "operationId": "updatePayment",
        "parameters": [
          {
            "name": "paymentId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdatePaymentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaymentResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/payments/by-order/{clientOrderId}": {
      "get": {
        "tags": [
          "Payments"
        ],
        "summary": "Get payment by order ID",
        "operationId": "getPaymentByOrderId",
        "parameters": [
          {
            "name": "clientOrderId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Payment found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaymentResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/payments/{paymentId}/capture": {
      "post": {
        "tags": [
          "Payments"
        ],
        "summary": "Capture a payment",
        "operationId": "capturePayment",
        "parameters": [
          {
            "name": "paymentId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Payment captured",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaymentResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/payments/{paymentId}/refund": {
      "post": {
        "tags": [
          "Payments"
        ],
        "summary": "Refund a payment",
        "operationId": "refundPayment",
        "parameters": [
          {
            "name": "paymentId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefundPaymentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Refund initiated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RefundResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/payments/resend-failed-callbacks": {
      "post": {
        "tags": [
          "Payments"
        ],
        "summary": "Resend failed callbacks",
        "operationId": "resendFailedCallbacks",
        "responses": {
          "200": {
            "description": "Callbacks resent",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResendCallbacksResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/providers": {
      "get": {
        "tags": [
          "Providers"
        ],
        "summary": "List all providers",
        "operationId": "getProviders",
        "responses": {
          "200": {
            "description": "Provider list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/providers/{providerId}/client-config": {
      "get": {
        "tags": [
          "Providers"
        ],
        "summary": "Get provider client config",
        "operationId": "getProviderClientConfig",
        "parameters": [
          {
            "name": "providerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Provider config",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderClientConfig"
                }
              }
            }
          }
        }
      }
    },
    "/api/providers/stripe/payment-methods": {
      "get": {
        "tags": [
          "Providers"
        ],
        "summary": "Get Stripe payment methods",
        "operationId": "getStripePaymentMethods",
        "parameters": [
          {
            "name": "merchantCountry",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "customerCountry",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "currency",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Payment methods retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaymentMethodsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid query"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "schemas": {
      "PaymentProviderType": {
        "type": "string",
        "enum": [
          "STRIPE",
          "PAYPAL",
          "NOWPAYMENTS",
          "PAYSAFE"
        ]
      },
      "PaymentStatus": {
        "type": "string",
        "enum": [
          "PENDING",
          "PROCESSING",
          "REQUIRES_ACTION",
          "NEEDS_CAPTURING",
          "PARTIALLY_PAYED",
          "COMPLETED",
          "FAILED",
          "EXPIRED",
          "CANCELLED",
          "REFUNDED",
          "PARTIALLY_REFUNDED",
          "DISPUTED"
        ]
      },
      "CreatePaymentRequest": {
        "type": "object",
        "required": [
          "clientOrderId",
          "provider",
          "amount",
          "currency",
          "successUrl",
          "cancelUrl"
        ],
        "properties": {
          "clientOrderId": {
            "type": "string"
          },
          "provider": {
            "$ref": "#/components/schemas/PaymentProviderType"
          },
          "amount": {
            "type": "number"
          },
          "currency": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "customerEmail": {
            "type": "string"
          },
          "successUrl": {
            "type": "string"
          },
          "cancelUrl": {
            "type": "string"
          },
          "callbackUrl": {
            "type": "string"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          },
          "autoCapture": {
            "type": "boolean",
            "default": false
          }
        }
      },
      "UpdatePaymentRequest": {
        "type": "object",
        "properties": {
          "metadata": {
            "type": "object",
            "additionalProperties": true
          },
          "callbackUrl": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "customerEmail": {
            "type": "string"
          }
        }
      },
      "RefundPaymentRequest": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "number"
          },
          "reason": {
            "type": "string"
          }
        }
      },
      "PaymentResponse": {
        "type": "object",
        "properties": {
          "paymentId": {
            "type": "string",
            "format": "uuid"
          },
          "clientOrderId": {
            "type": "string"
          },
          "provider": {
            "$ref": "#/components/schemas/PaymentProviderType"
          },
          "status": {
            "$ref": "#/components/schemas/PaymentStatus"
          },
          "amount": {
            "type": "number"
          },
          "amountPaid": {
            "type": "number"
          },
          "currency": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "customerEmail": {
            "type": "string"
          },
          "checkoutUrl": {
            "type": "string"
          },
          "providerPaymentId": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          },
          "errorMessage": {
            "type": "string"
          }
        }
      },
      "RefundResponse": {
        "type": "object",
        "properties": {
          "refundId": {
            "type": "string",
            "format": "uuid"
          },
          "paymentId": {
            "type": "string",
            "format": "uuid"
          },
          "providerRefundId": {
            "type": "string"
          },
          "amount": {
            "type": "number"
          },
          "originalAmount": {
            "type": "number"
          },
          "remainingAmount": {
            "type": "number"
          },
          "status": {
            "type": "string"
          },
          "reason": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time"
          },
          "errorMessage": {
            "type": "string"
          }
        }
      },
      "ResendCallbacksResponse": {
        "type": "object",
        "properties": {
          "resent": {
            "type": "integer"
          }
        }
      },
      "ProviderInfo": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "enabled": {
            "type": "boolean"
          },
          "supportedCurrencies": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "features": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "supportedCrypto": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ProviderListResponse": {
        "type": "object",
        "properties": {
          "providers": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProviderInfo"
            }
          }
        }
      },
      "ProviderClientConfig": {
        "type": "object",
        "properties": {
          "provider": {
            "type": "string"
          },
          "publishableKey": {
            "type": "string"
          },
          "clientId": {
            "type": "string"
          }
        }
      },
      "PaymentMethodsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "merchantCountry": {
            "type": "string"
          },
          "customerCountry": {
            "type": "string"
          },
          "currency": {
            "type": "string"
          },
          "paymentMethods": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PaymentMethodDetail"
            }
          }
        }
      },
      "PaymentMethodDetail": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "icon": {
            "type": "string"
          }
        }
      }
    }
  }
}
